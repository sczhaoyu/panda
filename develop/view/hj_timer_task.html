{{template "header" .}}
<div  data-options="region:'center',title:'数据表信息'">
	<table id="dg" style="width:auto;height:auto;"></table>
	<!--保存窗口-->
	<div id="win" class="easyui-window" closed="true" 
	data-options="modal:true,
				  resizable:false,
				  maximizable:false,
				  minimizable:false,
				  collapsible:false"  
	style="width:480px;height:260px;">
		<form id="saveOrUpdate" method="post" style="padding:10px;">
			     <p>ID: <input type="text" name="timerTaskId" /></p>
			     <p>任务名称: <input type="text" name="name" /></p>
			     <p>开始时间: <input type="text" name="ctime" /></p>
			     <p>任务结束时间: <input type="text" name="etime" /></p>
			     <p>任务开销时间毫秒: <input type="text" name="millisecond" /></p>
			     <p>任务成功或者失败（0成功，1失败）: <input type="text" name="success" /></p>
			     <p>任务备注信息: <input type="text" name="remarks" /></p>
			     
			<div style="padding:5px;text-align:center;">
				<a id="addOrUpdate" 
				   class="easyui-linkbutton" 
				   icon="icon-ok"
				   onclick="submitForm()"></a>
			</div>
		</form>
	</div>
	<!--保存窗口 END-->
</div>
<script type="text/javascript">
	$(function(){
		var pager =$('#dg').datagrid({
			border:false,
			fitColumns:true,
			url:"/timer_task/list",
			rownumbers:true,
			singleSelect:true,
			pagination:true,
			pageSize:15,
			pageList: [15,30,50,100],
			columns:[[
			    
			       {field:'timerTaskId',title:' ID',width:80},
			       {field:'name',title:' 任务名称',width:80},
			       {field:'ctime',title:' 开始时间',width:80},
			       {field:'etime',title:' 任务结束时间',width:80},
			       {field:'millisecond',title:' 任务开销时间毫秒',width:80},
			       {field:'success',title:' 任务成功或者失败（0成功，1失败）',width:80},
			       {field:'remarks',title:' 任务备注信息',width:80},
			       {field:'cz',title:'操作',width:80,
					formatter:function(value,rec){
					   var btn = '<a  onclick="saveOrUpdate('+rec.timerTaskId+')"  style="padding:0px;" class="editcls"></a>';
					   btn+='<a  onclick="deleteByid('+rec.timerTaskId+')" style="padding:0px;" class="deletecls"></a>';
					return btn;
				}}
			]],
			onLoadSuccess:function(data){
				$('.editcls').linkbutton({text:'修改',plain:true,iconCls:'icon-edit'});
				$('.deletecls').linkbutton({text:'删除',plain:true,iconCls:'icon-remove'});
			}
		}).datagrid('getPager');
		pager.pagination({
			buttons:[{
				iconCls:'icon-add',
				handler:function(){
				  saveOrUpdate(""); 
				}
			}]
		})
	});

function saveOrUpdate(id){
    if (id!="") {
    	$('#win').window({title:"修改",iconCls:'icon-edit'});
    	$('#addOrUpdate').linkbutton({text:"确认修改"});
    	$.post("/timer_task/byid",{"timerTaskId":id},function(d){
			if (d.success) {
				 
				 $("input[name='timerTaskId']").val(d.ret.timerTaskId);
				 $("input[name='name']").val(d.ret.name);
				 $("input[name='ctime']").val(d.ret.ctime);
				 $("input[name='etime']").val(d.ret.etime);
				 $("input[name='millisecond']").val(d.ret.millisecond);
				 $("input[name='success']").val(d.ret.success);
				 $("input[name='remarks']").val(d.ret.remarks);
				$('#win').window('open');
			}
		},"json");
    }else{
    	$('#win').window({title:"新建",iconCls:'icon-save'});
    	$('#addOrUpdate').linkbutton({text:"保存"});
    	 
				 $("input[name='timerTaskId']").val("");
				 $("input[name='name']").val("");
				 $("input[name='ctime']").val("");
				 $("input[name='etime']").val("");
				 $("input[name='millisecond']").val("");
				 $("input[name='success']").val("");
				 $("input[name='remarks']").val("");
				$('#win').window('open');
    	
    }
	
}
//删除该数据
function deleteByid(id){
$.post("/timer_task/delete",{"timerTaskId":id},function(d){
//调用表单刷新
$('#dg').datagrid();
alert(d); 
},"json");
  
}
function submitForm(){
  var url="/timer_task/update";
  if ($("input[name='timerTaskId']").val()=="") {
      url="/timer_task/save";
  }
  $('#saveOrUpdate').form('submit', {
	    url:url,
	    onSubmit: function(){
	         $.messager.progress({
                msg:'处理中...'
            });
	    },
	    success:function(data){
	    	  $.messager.progress('close');
	    	  $('#dg').datagrid();
	          alert(JSON.parse(data));
	    }
	});
}
</script>